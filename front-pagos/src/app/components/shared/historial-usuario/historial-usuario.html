<!-- Contenedor principal del historial de boletas del usuario -->
<div class="bg-white rounded-lg shadow-lg p-6 mb-6">
  <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-3">
    Historial de boletas (pagadas) del encargado
  </h2>

  <!-- Información del encargado si está disponible -->
  <div
    *ngIf="nombreEncargado"
    class="bg-blue-50 border border-blue-200 rounded-md p-3 mb-4">
    <span class="text-sm font-medium text-gray-700">
      Encargado: <span class="font-semibold">{{ nombreEncargado }}</span>
      (DNI: <span class="font-semibold">{{ dniEncargado }}</span>)
    </span>
  </div>

  <!-- Indicador de carga -->
  <div *ngIf="loading" class="text-center py-8 text-gray-600">
    Cargando historial...
  </div>

  <!-- Mensaje de error -->
  <div *ngIf="error" class="p-3 bg-red-50 border border-red-200 rounded-md text-danger">
    {{ error }}
  </div>

  <!-- Tabla de boletas si hay datos -->
  <div *ngIf="!loading && boletas.length > 0" class="overflow-x-auto rounded-lg border border-gray-200 shadow-sm mt-4">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
            ID
          </th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
            Cliente
          </th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
            Documento
          </th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
            Fecha emisión
          </th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
            Dirección
          </th>
          <th class="px-4 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider">
            Total
          </th>
          <th class="px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase tracking-wider">
            Detalles
          </th>
          <th class="px-4 py-3 text-center text-xs font-medium text-gray-700 uppercase tracking-wider">
            Acción
          </th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <!-- Fila por cada boleta -->
        <tr *ngFor="let b of boletas" class="hover:bg-gray-50 transition-colors">
          <td class="px-4 py-3 text-sm font-medium text-gray-900">{{ b.id }}</td>
          <td class="px-4 py-3 text-sm text-gray-700">{{ b.nombre }}</td>
          <td class="px-4 py-3 text-sm text-gray-700">{{ b.documentoIdentidad }}</td>
          <td class="px-4 py-3 text-sm text-gray-700">
            {{ b.fechaEmision ? (b.fechaEmision | date:'dd/MM/yyyy') : '-' }}
          </td>
          <td class="px-4 py-3 text-sm text-gray-700">{{ b.direccion || '-' }}</td>
          <td class="px-4 py-3 text-sm text-right font-semibold text-gray-900">
            S/. {{ totalBoleta(b) | number:'1.2-2' }}
          </td>
          <td class="px-4 py-3 text-center">
            <!-- Detalle expandible con tabla interna -->
            <details class="cursor-pointer">
              <summary class="text-blue-600 hover:text-blue-800 font-medium text-sm list-none">
                Ver ítems ({{ b.detalles.length || 0 }})
              </summary>
              
              <div *ngIf="b.detalles && b.detalles.length > 0" class="mt-3 bg-gray-50 rounded-md p-3">
                <table class="min-w-full text-sm">
                  <thead>
                    <tr class="border-b border-gray-200">
                      <th class="text-left py-2 px-2 font-medium text-gray-700">Concepto</th>
                      <th class="text-center py-2 px-2 font-medium text-gray-700">Cantidad</th>
                      <th class="text-right py-2 px-2 font-medium text-gray-700">Precio unit.</th>
                      <th class="text-right py-2 px-2 font-medium text-gray-700">Subtotal</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Fila por cada detalle -->
                    <tr *ngFor="let d of b.detalles" class="border-b border-gray-100">
                      <td class="py-2 px-2 text-gray-700">{{ conceptoNombre(d) }}</td>
                      <td class="py-2 px-2 text-center text-gray-700">{{ d.cantidad }}</td>
                      <td class="py-2 px-2 text-right text-gray-700">S/. {{ precioUnitario(d) | number:'1.2-2' }}</td>
                      <td class="py-2 px-2 text-right font-semibold text-gray-900">S/. {{ subtotalDetalle(d) | number:'1.2-2' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <div *ngIf="!b.detalles || b.detalles.length === 0" class="mt-2 text-gray-500 text-sm">
                No hay detalles.
              </div>
            </details>
          </td>
          <td class="px-4 py-3 text-center">
            <!-- Botón para imprimir boleta -->
            <button
              type="button"
              (click)="imprimirBoleta(b)"
              class="px-3 py-1 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 hover:shadow-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              Imprimir
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Mensaje cuando no hay boletas -->
  <div *ngIf="!loading && boletas.length === 0 && !error" class="text-center py-8 text-gray-500">
    No se encontraron boletas pagadas por este encargado.
  </div>
</div>